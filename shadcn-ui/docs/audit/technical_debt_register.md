# The Bazaar - Technical Debt Register

**Auditor:** Bob, Architect
**Date:** 2025-10-31

This document lists identified areas of technical debt within The Bazaar platform. Each item includes an estimate of the effort required to address it.

| ID  | Area         | Description                                                                                                                                                           | Impact                                                                                    | Effort (Story Points) | Recommended Action                                                                                                             |
| :-: | ------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- | :-------------------: | ------------------------------------------------------------------------------------------------------------------------------ |
| 1   | **Security** | The RLS policy for `profiles` is too permissive, potentially exposing user PII like emails to the public.                                                             | High (Data Privacy Violation)                                                             |           3           | Refactor the policy to only expose non-sensitive data. Create a separate, authenticated endpoint for sensitive profile information. |
| 2   | **Admin**    | The `admin` role is monolithic, granting all permissions to any admin user. This violates the principle of least privilege.                                             | High (Security Risk, Operational Risk)                                                    |           8           | Implement a granular RBAC system for administrators. Create distinct roles (e.g., `SUPER_ADMIN`, `MODERATOR`, `SUPPORT`).      |
| 3   | **Admin**    | No dedicated audit trail for administrative or vendor actions. It's impossible to track critical changes to data like product prices, vendor verification, or orders. | High (Security, Compliance, Debugging)                                                    |           5           | Create an `audit_log` table to record important events, including user, action, target entity, and timestamp.                |
| 4   | **Payments** | The `payments` table schema is too generic and lacks robust state management for handling complex transaction flows (e.g., multi-vendor payouts, refunds, chargebacks). | Medium (Financial Risk, Poor User Experience)                                             |           8           | Enhance the `payments` table with a state machine and detailed transaction history. Consider a dedicated payment service.      |
| 5   | **Arch**     | Business logic is heavily concentrated in RLS policies, which can become difficult to test, debug, and maintain as complexity grows.                                   | Medium (Maintainability, Scalability)                                                     |           5           | Migrate complex business logic (e.g., order processing, subscription management) from RLS to Supabase Edge Functions.        |
| 6   | **Arch**     | The reliance on the default PostgREST API may lead to inefficient data fetching (over-fetching/under-fetching) on complex pages.                                        | Low (Performance)                                                                         |          13           | Introduce a GraphQL API (e.g., using Supabase's GraphQL extension) for data-heavy client components.                           |

**Effort Estimation (Story Points):**
- **1-3:** Small task, can be done in a few days.
- **5:** Medium task, requires a week of focused effort.
- **8-13:** Large task, requires significant design and implementation effort.